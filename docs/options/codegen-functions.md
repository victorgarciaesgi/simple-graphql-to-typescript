# codegen-functions

### Type: `boolean`

Sgts can generate all your methods fully typed and cancellabled;
It uses Apollo Client behing the hood and as a dependency

::: warning
**Support for Subcriptions in development**
:::

## Exemple

```bash
sgts -e https://json-placeholder-graphql.herokuapp.com/graphql --codegen-functions
```

You just need to pass yout apolloClient instance to the root constructor of sgts

**Generated result exemple**

```typescript
{
  posts(): FragmentableQueryWithOptionalArgs<Post[], postsArgs> {
    return {
      $fragment: (fragment: string | DocumentNode) => {
        const { isString, isFragment, fragmentName } = guessFragmentType(fragment);
        const query = sgtsQL`
          query posts ($userId: Int) {
            posts(userId: $userId) {
              ${isString ? fragment : '...' + fragmentName}
            }
          } ${isFragment ? fragment : ''}
          `;

        return abortableQuery(query, true);
      }
    };
  },
}
```

## Usage

::: tip
`apiProvider` is generated by sgts on the same files as your models with the option `--codegen-functions`
:::

```ts
import { apiProvider } from '~/generated.ts';
import ApolloClient from 'apollo-client';

const apolloClient = new ApolloClient({
  ...
});

const sgts = apiProvider(apolloClient);


// You can either use a GraphQL fragment

const commentFragment = gql`
  fragment commentFragment on Comment {
    id
    name
    body
  }
`
// OR a simple string

const commentFragment = `
  id
  name
  body
`

const commentsQuery = sgts.comments().$fragment(commentFragment);

commentsQuery.$args({postId: 5}).$fetch().then(data => console.log(data))

// You can cancel your request any time

commentsQuery.$abort();
```

::: tip

**Also, Sgts will generate all fragments by default**

Sgts handle the fragment generation,

_Exemple from generated project in production_

```typescript
export const ReportConnectionFragment = sgtsQL` 
  fragment ReportConnectionFragment on ReportConnection {
    edges { node { uuid category status } cursor } aggregate { count } pageInfo { hasNextPage hasPreviousPage startCursor endCursor } 
  }
`;

return {
  /** Get list of reports */
  reports(): FragmentableQueryWithArgs<ReportConnection, reportsArgs> {
    const defaultQuery = sgtsQL`
        query reports ($where: ReportWhereInput!,$first: Int,$after: ID) {
          reports(where: $where,first: $first,after: $after) {
            ...ReportConnectionFragment
          }
        } ${ReportConnectionFragment}
      `;
    return {
      $fragment: (fragment: string | DocumentNode) => {
        const { isString, isFragment, fragmentName } = guessFragmentType(fragment);
        const query = sgtsQL`
            query reports ($where: ReportWhereInput!,$first: Int,$after: ID) {
              reports(where: $where,first: $first,after: $after) {
                edges { node {${
                  isString ? fragment : '...' + fragmentName
                }} cursor } aggregate { count } pageInfo { hasNextPage hasPreviousPage startCursor endCursor } 
              }
            } ${isFragment ? fragment : ''}
            `;
        return abortableQuery(query, true, false);
      },
      ...abortableQuery(defaultQuery, true, false),
    };
  },
};
```

:::
